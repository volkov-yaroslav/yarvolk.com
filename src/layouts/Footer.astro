---
import '@styles/components/footer.css';

import menu from '@config/menus.json';
import siteConfig from '@config/site.config.json';

const { isContactPage = false } = Astro.props;

const { socialLinks, logoText } = siteConfig;
const { footerMenu } = menu;

const year = new Date().getFullYear();
const animatedLines = Array.from({ length: 5 });
---

<footer class={`site-footer relative overflow-hidden ${isContactPage ? 'pt-8' : 'pt-28'} pb-16`}>
  {!isContactPage && (
    <div class="mb-20 overflow-hidden">
      <a
        href="/contact"
        class="footer-cta relative w-[1920px] max-w-full mx-auto overflow-hidden block text-5xl text-white font-secondary font-medium group"
      >
        {[0, 1].map((i) => (
          <div class={`animated-line animated-line-${i === 0 ? 'one mb-5' : 'two'} relative flex whitespace-nowrap`}>
            <div class="line-block pb-[6px] flex">
              {animatedLines.map((_, j) => (
                <span class="mr-24">
                  <span class="cta-text group-hover:opacity-75">Let’s make something</span>
                  <img
                    class="inline-block ml-16 cta-icon"
                    src="/images/arrow-right.svg"
                    alt="arrow-right"
                    height="31"
                    width="39"
                    loading="lazy"
                  />
                </span>
              ))}
            </div>
            <div class="line-block-copy pb-[6px] flex">
              {animatedLines.map((_, j) => (
                <span class="mr-24">
                  <span class="cta-text group-hover:opacity-75">Let’s make something</span>
                  <img
                    class="inline-block ml-16 cta-icon"
                    src="/images/arrow-right.svg"
                    alt="arrow-right"
                    height="31"
                    width="39"
                    loading="lazy"
                  />
                </span>
              ))}
            </div>
          </div>
        ))}
      </a>
    </div>
  )}

  <div class="container">
    <div class="row">
      <div class="md:col-6 text-center md:text-left mb-4">
        <ul class="inline-flex flex-wrap justify-center md:justify-start gap-x-6">
          {socialLinks.map((item) => (
            <li class="inline-block hover:opacity-75 transition-op duration-300">
              <a href={item.link} class="link">{item.fullName}</a>
            </li>
          ))}
        </ul>
      </div>

      <div class="md:col-6 text-center md:text-right mb-4">
        <ul class="inline-flex flex-wrap justify-center md:justify-end gap-x-6">
          {footerMenu.map((item) => (
            <li class="inline-block hover:opacity-75 transition-op duration-300">
              <a href={item.link} class="link">{item.name}</a>
            </li>
          ))}
        </ul>
      </div>

      <div class="md:col-6 text-center md:text-left mb-4 md:mb-0">
        <p class="text-white/75">&copy; {year} {logoText}. All rights reserved.</p>
      </div>

      <div class="md:col-6 text-center md:text-right">
        <div class="theme-switcher inline-flex items-center rounded-full border border-white/20 bg-white/5 p-1" data-theme-switcher>
          <button class="theme-switcher-btn" type="button" data-theme-option="auto" aria-pressed="false">Auto</button>
          <button class="theme-switcher-btn" type="button" data-theme-option="light" aria-pressed="false">Light</button>
          <button class="theme-switcher-btn" type="button" data-theme-option="dark" aria-pressed="false">Dark</button>
        </div>
      </div>
    </div>
  </div>
</footer>

<script is:inline>
  (() => {
    const key = 'yarvolk-theme-preference';
    const root = document.documentElement;
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    const buttons = Array.from(document.querySelectorAll('[data-theme-option]'));
    const footer = document.querySelector('.site-footer');

    if (!buttons.length) return;

    const readPreference = () => {
      const stored = localStorage.getItem(key);
      return stored === 'light' || stored === 'dark' || stored === 'auto' ? stored : 'auto';
    };

    const applyTheme = (preference) => {
      const resolved = preference === 'auto'
        ? (mediaQuery.matches ? 'dark' : 'light')
        : preference;

      root.dataset.themePreference = preference;
      root.dataset.theme = resolved;
      root.classList.toggle('dark', resolved === 'dark');
      root.style.colorScheme = resolved;
    };

    const setActiveButton = (preference) => {
      buttons.forEach((button) => {
        const active = button.dataset.themeOption === preference;
        button.classList.toggle('is-active', active);
        button.setAttribute('aria-pressed', active ? 'true' : 'false');
      });
    };

    const currentPreference = readPreference();
    applyTheme(currentPreference);
    setActiveButton(currentPreference);

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        const preference = button.dataset.themeOption || 'auto';
        localStorage.setItem(key, preference);
        applyTheme(preference);
        setActiveButton(preference);
      });
    });

    mediaQuery.addEventListener('change', () => {
      if (readPreference() === 'auto') {
        applyTheme('auto');
      }
    });

    if (footer) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            footer.classList.toggle('footer-glow-active', entry.isIntersecting);
          });
        },
        { threshold: 0.2 }
      );
      observer.observe(footer);
    }
  })();
</script>
